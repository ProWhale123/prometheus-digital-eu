---
// src/pages/blog/[...slug].astro
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Footer from "../../components/Footer.astro";
import Header from "../../components/Header.astro";
import { Image } from "astro:assets";
import FloatingElement from "../../components/FloatingElement.astro";
import SpotlightCard from "../../components/react/SpotlightCard.jsx";
import authorImage from "../../../public/images/arpad-bretz.JPG";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }));
}

const post = Astro.props;
const { Content } = await post.render();
---

<Layout title={post.data.title} description={post.data.description}>
  <Header />

  <div class="fixed top-0 left-0 w-full h-1 bg-gray-800 z-50">
    <div
      class="h-full bg-gradient-to-r from-sky-500 to-cyan-300 w-0"
      id="progress-bar"
    >
    </div>
  </div>

  <main class="overflow-hidden">
    <section
      class="relative h-[60vh] min-h-[500px] flex items-center justify-center text-center overflow-hidden"
    >
      <div class="absolute inset-0 z-0">
        <div
          class="parallax-bg w-full h-[120%] -translate-y-[10%] will-change-transform"
        >
          <Image
            src={post.data.heroImage}
            alt={post.data.title}
            quality="high"
            class="w-full h-full object-cover opacity-50"
          />
        </div>
      </div>

      <div class="absolute inset-0 bg-[#0B1120]/60 backdrop-blur-sm"></div>

      <div class="container mx-auto px-6 relative z-10 pt-24 pb-12">
        <div class="hero-element opacity-0 translate-y-8 mb-6">
          <span
            class="inline-block px-4 py-1.5 rounded-full bg-sky-500/10 text-sky-300 text-sm font-bold border border-sky-500/20 uppercase tracking-wider backdrop-blur-md"
          >
            {post.data.tags[0]}
          </span>
        </div>

        <h1
          class="font-black text-white mb-6 max-w-5xl mx-auto uppercase tracking-tight"
        >
          <div class="overflow-hidden py-4">
            <span
              class="hero-element block text-4xl md:text-6xl lg:text-7xl leading-[1.1] opacity-0 translate-y-20"
            >
              {post.data.title}
            </span>
          </div>
        </h1>

        <div
          class="hero-element opacity-0 translate-y-8 flex flex-wrap items-center justify-center gap-6 text-gray-300 font-medium"
        >
          <div
            class="flex items-center bg-gray-900/50 px-4 py-2 rounded-full border border-white/5"
          >
            <svg
              class="w-5 h-5 mr-2 text-sky-400"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              ><path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              ></path></svg
            >
            {
              post.data.pubDate.toLocaleDateString("en-US", {
                year: "numeric",
                month: "long",
                day: "numeric",
              })
            }
          </div>
          <div
            class="flex items-center bg-gray-900/50 px-4 py-2 rounded-full border border-white/5"
          >
            <svg
              class="w-5 h-5 mr-2 text-sky-400"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              ><path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
              ></path></svg
            >
            {post.data.author}
          </div>
        </div>
      </div>
    </section>

    <article class="relative py-20 md:py-24 bg-[#0B1120] overflow-hidden">
      <div
        class="absolute inset-0 bg-[url('/images/grid-pattern.svg')] bg-[length:40px_40px] opacity-[0.03] pointer-events-none"
      >
      </div>
      <FloatingElement speed={0.1} class="top-40 -right-20 z-0 opacity-10">
        <div class="w-96 h-96 rounded-full bg-sky-500 blur-[120px]"></div>
      </FloatingElement>

      <div class="container mx-auto px-6 relative z-10">
        <div class="post-content max-w-3xl mx-auto">
          <Content />

          <div class="mt-24 pt-12 border-t border-white/10">
            <SpotlightCard
              client:visible
              className="bg-gray-900/40 backdrop-blur-md"
            >
              <div
                class="p-8 md:p-10 flex flex-col md:flex-row items-center gap-8"
              >
                <div class="relative shrink-0">
                  <div
                    class="absolute inset-0 bg-gradient-to-r from-sky-500 to-cyan-300 rounded-full blur opacity-50"
                  >
                  </div>
                  <Image
                    src={authorImage}
                    alt="Árpád Bretz"
                    width={120}
                    height={120}
                    class="relative w-24 h-24 md:w-28 md:h-28 rounded-full border-2 border-white/20 shadow-xl object-cover"
                  />
                </div>
                <div class="text-center md:text-left">
                  <h3 class="text-xl font-bold text-white mb-2">
                    About the Author
                  </h3>
                  <p class="text-gray-400 leading-relaxed mb-6">
                    Founder and lead developer of Prometheus Digital. I believe
                    web development is not just about coding, but about creating
                    value.
                  </p>
                  <div
                    class="flex flex-col md:flex-row gap-4 justify-center md:justify-start"
                  >
                    <a
                      href="/contact"
                      class="inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-sky-500 to-cyan-300 text-white rounded-full transition-all hover:shadow-[0_0_20px_rgba(14,165,233,0.4)] hover:scale-105 text-sm font-bold"
                    >
                      Let's Work Together
                    </a>
                    <a
                      href="/blog"
                      class="inline-flex items-center justify-center px-6 py-3 text-gray-400 hover:text-white transition-colors text-sm font-medium border border-white/10 hover:border-white/30 rounded-full"
                    >
                      ← Back to Blog
                    </a>
                  </div>
                </div>
              </div>
              SpotlightCard>
            </SpotlightCard>
          </div>
        </div>
      </div>
    </article>

    <Footer />
  </main>

  <script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    gsap.registerPlugin(ScrollTrigger);

    function initBlogPost() {
      const updateProgress = () => {
        const winScroll =
          document.body.scrollTop || document.documentElement.scrollTop;
        const height =
          document.documentElement.scrollHeight -
          document.documentElement.clientHeight;
        const scrolled = (winScroll / height) * 100;
        const bar = document.getElementById("progress-bar");
        if (bar) bar.style.width = scrolled + "%";
      };
      window.removeEventListener("scroll", updateProgress);
      window.addEventListener("scroll", updateProgress);

      const tl = gsap.timeline({ delay: 0.2 });
      tl.to(".hero-element", {
        y: 0,
        opacity: 1,
        duration: 1,
        stagger: 0.15,
        ease: "power4.out",
      });

      gsap.to(".parallax-bg", {
        yPercent: 20,
        ease: "none",
        scrollTrigger: {
          trigger: "main",
          start: "top top",
          end: "bottom top",
          scrub: true,
        },
      });
    }

    initBlogPost();
    document.addEventListener("astro:page-load", initBlogPost);
  </script>

  <style is:global>
    .post-content {
      color: #cbd5e1;
      font-size: 1.125rem;
      line-height: 1.8;
    }

    .post-content h2 {
      color: #ffffff;
      font-size: 2rem;
      font-weight: 800;
      margin-top: 3em;
      margin-bottom: 1em;
      letter-spacing: -0.02em;
      position: relative;
      display: inline-block;
    }
    .post-content h2::after {
      content: "";
      position: absolute;
      bottom: -10px;
      left: 0;
      width: 60px;
      height: 3px;
      background: linear-gradient(to right, #38bdf8, transparent);
    }

    .post-content h3 {
      color: #e2e8f0;
      font-size: 1.5rem;
      font-weight: 700;
      margin-top: 2.5em;
      margin-bottom: 0.8em;
    }

    .post-content p {
      margin-bottom: 1.5em;
    }
    .post-content strong {
      color: #ffffff;
      font-weight: 700;
    }

    /* FIXED: Clearer link style, no background */
    .post-content a {
      color: #f3f5f6;
      text-decoration: none;
      border-bottom: 1px solid rgba(56, 189, 248, 0.5);
      transition: all 0.2s ease-in-out;
    }
    .post-content a:hover {
      color: #7dd3fc; /* sky-300 */
      border-bottom-color: #7dd3fc;
    }

    .post-content ul {
      list-style: none;
      margin: 2em 0;
      padding: 0;
    }
    .post-content li {
      position: relative;
      padding-left: 1.5em;
      margin-bottom: 0.8em;
      color: #cbd5e1;
    }
    .post-content li::before {
      content: "•";
      color: #38bdf8;
      font-weight: bold;
      font-size: 1.5em;
      position: absolute;
      left: 0;
      top: -5px;
    }

    .post-content blockquote {
      margin: 3em 0;
      padding: 2em;
      background: rgba(255, 255, 255, 0.03);
      border-left: 4px solid #38bdf8;
      border-radius: 0 1rem 1rem 0;
      font-style: italic;
      font-size: 1.25rem;
      color: #f1f5f9;
      position: relative;
    }

    .post-content pre {
      background: #1e293b !important;
      border-radius: 0.5rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
      margin: 2em 0;
      padding: 1.5em;
      overflow-x: auto;
    }
  </style></Layout
>
