---
// src/components/Header.astro
import { Image } from "astro:assets";
// Ensure logo path is correct
import logoImage from "../assets/images/logo.jpg";
import MagneticButton from "./react/MagneticButton.jsx";

const { pathname } = Astro.url;

// === CONFIGURATION ===
const HU_DOMAIN = "https://www.prometheusdigital.hu";

// Route Map (Left: English, Right: Hungarian)
const pathMapping = {
    "/": "/",
    "/services": "/szolgaltatasok",
    "/pricing": "/araink",
    "/works": "/munkaink",
    "/about": "/rolunk",
    "/blog": "/blog",
    "/contact": "/kapcsolat",
};

const cleanPath = pathname.replace(/\/$/, "") || "/";
const targetPath = pathMapping[cleanPath] || "/";
const targetUrl = `${HU_DOMAIN}${targetPath}`;

const navLinks = [
    { name: "Home", href: "/" },
    { name: "Services", href: "/services" },
    { name: "Pricing", href: "/pricing" },
    { name: "Works", href: "/works" },
    { name: "About", href: "/about" },
    { name: "Blog", href: "/blog" },
    { name: "Contact", href: "/contact" },
];
---

<header
    id="main-header"
    class="fixed top-0 left-0 right-0 z-50 transition-all duration-500 ease-in-out border-b border-transparent"
>
    <div class="container mx-auto px-6 py-4 flex justify-between items-center">
        <a href="/" class="block flex-shrink-0 relative z-50 group">
            <Image
                src={logoImage}
                alt="Prometheus Digital Logo"
                class="h-10 md:h-12 w-auto transition-transform duration-300 group-hover:scale-105"
                quality="high"
            />
        </a>

        <nav class="hidden lg:flex items-center space-x-8">
            {
                navLinks
                    .filter((link) => link.name !== "Contact")
                    .map((link) => {
                        const isActive =
                            pathname === link.href ||
                            (link.href !== "/" &&
                                pathname.startsWith(link.href));
                        return (
                            <a
                                href={link.href}
                                class:list={[
                                    "text-base font-medium transition-all duration-300 relative py-2 group",
                                    isActive
                                        ? "text-white"
                                        : "text-gray-400 hover:text-white",
                                ]}
                            >
                                {link.name}
                                {/* Hover & Active Underline Animation */}
                                <span
                                    class:list={[
                                        "absolute bottom-0 left-0 h-[2px] bg-gradient-to-r from-sky-400 to-cyan-300 transition-all duration-300 ease-out",
                                        isActive
                                            ? "w-full"
                                            : "w-0 group-hover:w-full",
                                    ]}
                                />
                            </a>
                        );
                    })
            }

            <div
                class="flex items-center gap-3 border-l border-white/10 pl-8 ml-4 h-6"
            >
                <a
                    href={targetUrl}
                    class="text-sm font-bold text-gray-500 hover:text-white transition-colors duration-300"
                    >HU</a
                >
                <span
                    class="text-sm font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-cyan-300 cursor-default"
                    >EN</span
                >
            </div>

            <div class="ml-4">
                <MagneticButton
                    href="/contact"
                    client:idle
                    className="bg-white text-gray-900 font-bold py-2.5 px-6 rounded-full transition-all duration-300 hover:bg-sky-50 hover:shadow-[0_0_20px_rgba(255,255,255,0.3)] hover:scale-105 flex items-center gap-2"
                >
                    Contact
                    <svg
                        class="w-4 h-4"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        ><path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg
                    >
                </MagneticButton>
            </div>
        </nav>

        <button
            id="mobile-menu-btn"
            class="lg:hidden z-50 flex flex-col justify-center items-center w-10 h-10 rounded-full bg-white/5 border border-white/10 backdrop-blur-sm transition-colors hover:bg-white/10 focus:outline-none"
            aria-label="Open Menu"
        >
            <span
                class="line line-1 block w-5 h-0.5 bg-white transition-transform duration-300 ease-in-out origin-center"
            ></span>
            <span
                class="line line-2 block w-5 h-0.5 bg-white mt-1.5 transition-transform duration-300 ease-in-out origin-center"
            ></span>
        </button>
    </div>
</header>

<div
    id="mobile-menu-panel"
    class="fixed inset-0 bg-[#0B1120] z-40 transform translate-x-full transition-transform duration-500 cubic-bezier(0.7, 0, 0.3, 1) lg:hidden flex flex-col"
>
    <div
        class="absolute inset-0 bg-[url('/images/grid-pattern.svg')] bg-[length:40px_40px] opacity-5 pointer-events-none"
    >
    </div>
    <div
        class="absolute bottom-0 right-0 w-64 h-64 bg-sky-500/10 rounded-full blur-[80px] pointer-events-none"
    >
    </div>

    <nav
        class="flex-1 flex flex-col justify-center items-center space-y-6 relative z-10 px-6"
    >
        {
            navLinks.map((link, index) => (
                <a
                    href={link.href}
                    class:list={[
                        "mobile-link text-4xl font-black uppercase tracking-tight hover:text-sky-400 transition-colors duration-300",
                        pathname === link.href ||
                        (link.href !== "/" && pathname.startsWith(link.href))
                            ? "text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-cyan-300"
                            : "text-gray-400",
                    ]}
                    style={`transition-delay: ${100 + index * 50}ms`}
                >
                    {link.name}
                </a>
            ))
        }

        <div
            class="mobile-link mt-8 pt-8 w-full max-w-xs border-t border-white/10 flex justify-center gap-8"
            style="transition-delay: 450ms"
        >
            <a
                href={targetUrl}
                class="text-2xl font-bold text-gray-600 hover:text-white transition-colors"
                >HU</a
            >
            <span class="text-2xl font-bold text-sky-400">EN</span>
        </div>
    </nav>
</div>

<script>
    function initHeader() {
        const header = document.getElementById("main-header");
        const mobileMenuBtn = document.getElementById("mobile-menu-btn");
        const mobileMenuPanel = document.getElementById("mobile-menu-panel");
        const mobileLinks = document.querySelectorAll(".mobile-link");
        let isMenuOpen = false;

        if (!header || !mobileMenuBtn || !mobileMenuPanel) return;

        // Reset state
        mobileMenuBtn.classList.remove("is-open");
        mobileMenuPanel.classList.add("translate-x-full");
        mobileMenuPanel.classList.remove("menu-active");
        document.body.style.overflow = "";

        const toggleMenu = () => {
            isMenuOpen = !isMenuOpen;
            mobileMenuBtn.classList.toggle("is-open");
            mobileMenuPanel.classList.toggle("translate-x-full"); // Tailwind translate class
            mobileMenuPanel.classList.toggle("menu-active");

            // Disable scroll on mobile if menu is open
            document.body.style.overflow = isMenuOpen ? "hidden" : "";
        };

        mobileMenuBtn.onclick = toggleMenu;

        // Close on link click
        mobileLinks.forEach((link) => {
            link.onclick = () => {
                if (isMenuOpen) toggleMenu();
            };
        });

        // Scroll Effect (Glassmorphism)
        const handleScroll = () => {
            if (window.scrollY > 20) {
                header.classList.add(
                    "bg-[#0B1120]/80",
                    "backdrop-blur-md",
                    "shadow-lg",
                    "border-white/5",
                );
                header.classList.remove("py-4", "border-transparent");
                header.classList.add("py-3"); // Shrink slightly
            } else {
                header.classList.remove(
                    "bg-[#0B1120]/80",
                    "backdrop-blur-md",
                    "shadow-lg",
                    "border-white/5",
                    "py-3",
                );
                header.classList.add("py-4", "border-transparent");
            }
        };

        window.removeEventListener("scroll", handleScroll);
        window.addEventListener("scroll", handleScroll);
        handleScroll(); // Init check
    }

    // View Transitions support
    initHeader();
    document.addEventListener("astro:page-load", initHeader);
</script>

<style>
    /* Hamburger animation */
    .is-open .line-1 {
        transform: translateY(4px) rotate(45deg);
    }
    .is-open .line-2 {
        transform: translateY(-4px) rotate(-45deg);
    }

    /* Staggered animation for mobile menu items */
    .mobile-link {
        opacity: 0;
        transform: translateY(20px);
        transition:
            opacity 0.4s ease-out,
            transform 0.4s ease-out;
    }
    #mobile-menu-panel.menu-active .mobile-link {
        opacity: 1;
        transform: translateY(0);
    }
</style>
